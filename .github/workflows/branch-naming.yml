name: branch-naming
on: [push]
jobs:
  Check-Branch-Name:
    runs-on: ubuntu-latest
    env:
      AUTHOR_EMAIL: ${{ join(github.event.commits.*.author.email) }}
      PUSHER_EMAIL: ${{ github.event.pusher.email }}
    steps:
      - name: Check out repository code
        uses: actions/checkout@master
      - run: echo "üí° The ${{ github.repository }} repository has been cloned to the runner."
      - name: Get Branch Name
        shell: bash
        run: echo "Running on branch ${GITHUB_REF#refs/heads/} "
      - run: echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"
        id: extract_branch
      - name: Check Branch Name Prefix Success
        run: echo "ü•≥ Yay! Correct Prefix!"
        if: |
          startsWith(steps.extract_branch.outputs.branch, 'fix')
          || startsWith(steps.extract_branch.outputs.branch, 'feature')
          || startsWith(steps.extract_branch.outputs.branch, 'test')
          || startsWith(steps.extract_branch.outputs.branch, 'hotfix')
      - name: Check Branch Name Prefix Failure
        run: echo " ü§¨ Name your branch correctly!"
        if: |
          !startsWith(steps.extract_branch.outputs.branch, 'fix')
          || !startsWith(steps.extract_branch.outputs.branch, 'feature')
          || !startsWith(steps.extract_branch.outputs.branch, 'test')
          || !startsWith(steps.extract_branch.outputs.branch, 'hotfix')
      - name: Log Environment Variables
        run: |
          echo "Author is $AUTHOR_EMAIL"
          echo "Pusher is $PUSHER_EMAIL"
      - name: Send Email
        uses: dawidd6/action-send-mail@v3
        with:
          # Required mail server address:
          server_address: mail.meg.codes
          # Required mail server port:
          server_port: 465
          # Optional (recommended): mail server username:
          username: ${{secrets.MAIL_USERNAME_TEST}}
          # Optional (recommended) mail server password:
          password: ${{secrets.MAIL_PASSWORD_TEST}}
          # Required mail subject:
          subject: Your Branch Name Needs Attention
          # Required recipients' addresses:
          to: ${{env.AUTHOR_EMAIL}}
          # Required sender full name (address can be skipped):
          from: Evereve Codebase # <user@example.com>
          # Optional whether this connection use TLS (default is true if server_port is 465)
          secure: true
          # Optional plain body:
          body: You gotta fix your branch name. The name ${{ steps.extract_branch.outputs.branch }} is bad.
          # Optional carbon copy recipients:
          cc: megan.martinson@evereve.com
          # Optional unsigned/invalid certificates allowance:
          ignore_cert: true
          # Optional converting Markdown to HTML (set content_type to text/html too):
          convert_markdown: true
      - name: List files in the repository
        run: |
          ls -al ${{ github.workspace }}
      - name: End Job Status
        run: echo "üçè This job's status is ${{ job.status }}."
        
